<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta de Desaf√≠os de F√∫tbol + AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@400;600&display=swap');

        body {
            background-color: #0f172a;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            overflow-x: hidden;
        }

        .casino-font {
            font-family: 'Teko', sans-serif;
            letter-spacing: 2px;
        }

        .slot-machine-container {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border: 4px solid #f59e0b;
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.3), inset 0 0 50px rgba(0,0,0,0.8);
            border-radius: 20px;
            position: relative;
        }

        .reel-window {
            background-color: #e2e8f0;
            border: 4px solid #334155;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            height: 160px;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.4), inset 0 -10px 20px rgba(0,0,0,0.4);
        }

        .reel-window::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, rgba(255,255,255,0.1) 40%, rgba(255,255,255,0.1) 60%, rgba(0,0,0,0.6) 100%);
            pointer-events: none;
            z-index: 10;
        }

        .reel-strip {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.1s linear;
        }

        .reel-item {
            height: 160px;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #1e293b;
            padding: 10px;
        }

        .reel-icon { font-size: 3rem; margin-bottom: 5px; }
        .reel-text { font-weight: 800; font-size: 1.25rem; text-transform: uppercase; line-height: 1.1; }
        .blur-spin { filter: blur(4px); }

        .lever-container {
            position: absolute; right: -40px; top: 50px; z-index: -1;
        }
        .lever-ball {
            width: 40px; height: 40px; background: #ef4444; border-radius: 50%;
            cursor: pointer; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.5); transition: transform 0.2s;
        }
        .lever-stick { width: 10px; height: 100px; background: #cbd5e1; margin: 0 auto; border-radius: 5px; }

        .challenge-card { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .ai-loader {
            border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #a855f7;
            width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Bot√≥n de configuraci√≥n de API */
        .api-config-btn {
            position: fixed; top: 10px; right: 10px;
            background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px;
            font-size: 0.8rem; color: #aaa; cursor: pointer; z-index: 50;
        }
        .api-config-btn:hover { color: white; background: rgba(0,0,0,0.8); }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 pb-20">

    <div class="api-config-btn" onclick="resetApiKey()">
        <i class="fas fa-key"></i> Cambiar API Key
    </div>

    <!-- Encabezado -->
    <header class="text-center mb-8 mt-4">
        <h1 class="text-5xl casino-font text-yellow-400 drop-shadow-lg">
            <i class="fas fa-futbol mr-2"></i> SCOUT MASTER <i class="fas fa-futbol ml-2"></i>
        </h1>
        <p class="text-slate-400 mt-2 text-lg">Gira la ruleta y desaf√≠a a la IA</p>
    </header>

    <!-- M√°quina Tragamonedas -->
    <div class="slot-machine-container w-full max-w-4xl p-6 md:p-10 mb-8">
        <div class="grid grid-cols-3 gap-4 mb-2 text-center text-yellow-500 font-bold tracking-wider text-sm md:text-base">
            <div>NACIONALIDAD</div>
            <div>EQUIPO</div>
            <div>COMPETICI√ìN</div>
        </div>

        <div class="grid grid-cols-3 gap-2 md:gap-6">
            <div class="reel-window"><div id="reel-country" class="reel-strip"><div class="reel-item"><span class="reel-icon">üè≥Ô∏è</span><span class="reel-text">Girar...</span></div></div></div>
            <div class="reel-window"><div id="reel-team" class="reel-strip"><div class="reel-item"><span class="reel-icon">üõ°Ô∏è</span><span class="reel-text">Girar...</span></div></div></div>
            <div class="reel-window"><div id="reel-comp" class="reel-strip"><div class="reel-item"><span class="reel-icon">üèÜ</span><span class="reel-text">Girar...</span></div></div></div>
        </div>

        <div class="lever-container hidden md:block">
            <div id="leverBall" class="lever-ball" onclick="spin()"></div>
            <div class="lever-stick"></div>
        </div>
    </div>

    <div class="text-center w-full max-w-md">
        <button onclick="spin()" id="spinBtn" class="bg-gradient-to-b from-yellow-400 to-yellow-600 hover:from-yellow-300 hover:to-yellow-500 text-black font-bold py-4 px-12 rounded-full text-2xl shadow-lg transform active:scale-95 transition-all w-full border-4 border-yellow-700 casino-font tracking-widest">
            ¬°MEZCLAR DESAF√çO!
        </button>
    </div>

    <div id="resultArea" class="mt-8 w-full max-w-2xl hidden mb-10">
        <div class="challenge-card bg-slate-800 border border-slate-700 rounded-xl p-6 text-center shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-600 opacity-10 rounded-full blur-3xl pointer-events-none"></div>

            <h3 class="text-yellow-400 text-xl font-bold mb-4 uppercase">Tu Misi√≥n:</h3>
            <p class="text-white text-xl md:text-2xl mb-6 leading-relaxed">
                "Nombra un jugador de nacionalidad <span id="resCountry" class="text-cyan-400 font-bold"></span> que haya jugado en <span id="resTeam" class="text-green-400 font-bold"></span> disputando la <span id="resComp" class="text-pink-400 font-bold"></span>"
            </p>
            
            <div class="flex justify-center mb-6">
                <button onclick="startTimer()" id="timerBtn" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded flex items-center gap-2 transition-colors">
                    <i class="fas fa-stopwatch"></i> <span id="timerDisplay">15s</span>
                </button>
            </div>

            <hr class="border-slate-700 my-4">

            <div class="mt-4">
                <p class="text-sm text-purple-400 mb-2 font-bold tracking-widest uppercase"><i class="fas fa-robot mr-1"></i> Asistente IA</p>
                
                <div class="flex gap-2 mb-3">
                    <input type="text" id="playerInput" placeholder="Escribe el nombre..." 
                           class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:outline-none focus:border-purple-500">
                    <button onclick="verifyPlayer()" class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded font-bold transition-colors whitespace-nowrap">Verificar ‚ú®</button>
                </div>

                <!-- Botones de Utilidad IA -->
                <div class="grid grid-cols-2 gap-2 mb-2">
                     <button onclick="getHint()" class="text-slate-400 hover:text-yellow-400 transition-colors py-2 px-3 border border-slate-700 rounded hover:border-yellow-400 text-sm"><i class="fas fa-lightbulb mr-1"></i> Pedir Pista</button>
                     <button onclick="getSolution()" class="text-slate-400 hover:text-green-400 transition-colors py-2 px-3 border border-slate-700 rounded hover:border-green-400 text-sm"><i class="fas fa-key mr-1"></i> Ver Soluci√≥n</button>
                </div>

                <!-- Nuevas Funciones Creativas IA -->
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="narrateIntro()" class="bg-slate-700 hover:bg-blue-600 text-white transition-colors py-2 px-3 rounded text-sm font-semibold flex justify-center items-center gap-2">
                        <i class="fas fa-microphone-alt"></i> Narrar Intro ‚ú®
                    </button>
                    <button onclick="suggestTactics()" class="bg-slate-700 hover:bg-indigo-600 text-white transition-colors py-2 px-3 rounded text-sm font-semibold flex justify-center items-center gap-2">
                        <i class="fas fa-clipboard-list"></i> T√°ctica DT ‚ú®
                    </button>
                </div>

                <div id="aiResponseBox" class="hidden mt-4 bg-slate-900/50 p-4 rounded-lg border border-purple-500/30 text-left text-sm">
                    <div id="aiLoading" class="hidden text-center text-purple-400"><span class="ai-loader mr-2"></span> Consultando a la IA...</div>
                    <div id="aiContent" class="text-slate-200"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GESTI√ìN SEGURA DE API KEY ---
        function getApiKey() {
            let key = localStorage.getItem("gemini_api_key");
            if (!key) {
                key = prompt("Para jugar con IA, pega tu API Key de Gemini:\n(Se guardar√° solo en tu navegador)");
                if (key) {
                    localStorage.setItem("gemini_api_key", key);
                    return key;
                } else {
                    alert("Se necesita la API Key para usar las funciones de IA.");
                    return null;
                }
            }
            return key;
        }

        function resetApiKey() {
            localStorage.removeItem("gemini_api_key");
            alert("Clave borrada. Se te pedir√° de nuevo al usar la IA.");
            location.reload();
        }

        // --- BASE DE DATOS DE F√öTBOL ---
        const soccerDB = {
            "Espa√±a üá™üá∏": {
                teams: [{ name: "Real Madrid", type: "top" }, { name: "FC Barcelona", type: "top" }, { name: "Atl√©tico Madrid", type: "top" }, { name: "Sevilla", type: "mid" }, { name: "Real Betis", type: "mid" }],
                comps: ["La Liga", "Copa del Rey", "Champions League", "Europa League"]
            },
            "Inglaterra üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø": {
                teams: [{ name: "Man. City", type: "top" }, { name: "Liverpool", type: "top" }, { name: "Arsenal", type: "top" }, { name: "Man. United", type: "top" }, { name: "Chelsea", type: "mid" }],
                comps: ["Premier League", "FA Cup", "Champions League", "Europa League"]
            },
            "Italia üáÆüáπ": {
                teams: [{ name: "Juventus", type: "top" }, { name: "Inter Milan", type: "top" }, { name: "AC Milan", type: "top" }, { name: "Napoli", type: "top" }, { name: "AS Roma", type: "mid" }],
                comps: ["Serie A", "Coppa Italia", "Champions League", "Europa League"]
            },
            "Alemania üá©üá™": {
                teams: [{ name: "Bayern Munich", type: "top" }, { name: "Dortmund", type: "top" }, { name: "Leverkusen", type: "top" }],
                comps: ["Bundesliga", "DFB-Pokal", "Champions League", "Europa League"]
            },
            "Argentina üá¶üá∑": {
                teams: [{ name: "Boca Juniors", type: "top" }, { name: "River Plate", type: "top" }, { name: "Independiente", type: "mid" }, { name: "Racing", type: "mid" }],
                comps: ["Liga Profesional", "Copa Argentina", "Copa Libertadores", "Copa Sudamericana"]
            },
            "Brasil üáßüá∑": {
                teams: [{ name: "Flamengo", type: "top" }, { name: "Palmeiras", type: "top" }, { name: "Sao Paulo", type: "mid" }, { name: "Santos", type: "mid" }],
                comps: ["Brasileirao", "Copa do Brasil", "Copa Libertadores", "Copa Sudamericana"]
            }
        };

        const fillerIcons = ["‚öΩ", "üëü", "ü•Ö", "üß§", "üö©", " whistle"];
        let isSpinning = false;
        let timerInterval;
        let currentChallenge = { country: "", team: "", comp: "" };

        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            document.getElementById('resultArea').classList.add('hidden');
            document.getElementById('aiResponseBox').classList.add('hidden');
            document.getElementById('aiContent').innerHTML = "";
            document.getElementById('playerInput').value = "";
            const btn = document.getElementById('spinBtn');
            btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
            
            const lever = document.getElementById('leverBall');
            if(lever) { lever.style.transform = "translateY(80px)"; setTimeout(() => lever.style.transform = "translateY(0)", 300); }

            // L√≥gica MEZCLADA (Modo Scout)
            const countries = Object.keys(soccerDB);
            const randomCountry = countries[Math.floor(Math.random() * countries.length)];

            let allTeamsList = [];
            Object.keys(soccerDB).forEach(countryKey => {
                const data = soccerDB[countryKey];
                data.teams.forEach(t => {
                    allTeamsList.push({ name: t.name, comps: data.comps });
                });
            });
            const randomTeamObj = allTeamsList[Math.floor(Math.random() * allTeamsList.length)];
            const randomTeam = randomTeamObj.name;
            const possibleComps = randomTeamObj.comps;
            const randomComp = possibleComps[Math.floor(Math.random() * possibleComps.length)];

            currentChallenge = { country: randomCountry, team: randomTeam, comp: randomComp };

            const reels = [
                { id: 'reel-country', finalVal: randomCountry, icon: 'üè≥Ô∏è' },
                { id: 'reel-team', finalVal: randomTeam, icon: 'üõ°Ô∏è' },
                { id: 'reel-comp', finalVal: randomComp, icon: 'üèÜ' }
            ];

            reels.forEach((reel, index) => { animateReel(reel.id, reel.finalVal, reel.icon, 1000 + (index * 600)); });

            setTimeout(() => {
                showResult(randomCountry, randomTeam, randomComp);
                isSpinning = false; btn.disabled = false; btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, 1000 + (2 * 600) + 500);
        }

        function animateReel(elementId, finalText, finalIcon, duration) {
            const strip = document.getElementById(elementId);
            strip.classList.add('blur-spin');
            const spinInterval = setInterval(() => {
                const randomIcon = fillerIcons[Math.floor(Math.random() * fillerIcons.length)];
                strip.innerHTML = `<div class="reel-item"><span class="reel-icon text-gray-400">${randomIcon}</span><span class="reel-text text-gray-400">...</span></div>`;
            }, 80);
            setTimeout(() => {
                clearInterval(spinInterval);
                strip.classList.remove('blur-spin');
                strip.innerHTML = `<div class="reel-item" style="animation: bounceIn 0.3s"><span class="reel-icon text-indigo-600">${finalIcon}</span><span class="reel-text text-slate-800">${finalText}</span></div>`;
            }, duration);
        }

        function showResult(country, team, comp) {
            const resArea = document.getElementById('resultArea');
            resArea.classList.remove('hidden');
            document.getElementById('resCountry').textContent = country;
            document.getElementById('resTeam').textContent = team;
            document.getElementById('resComp').textContent = comp;
            resetTimer();
        }

        async function callGemini(promptText) {
            const apiKey = getApiKey(); 
            if (!apiKey) return;

            const box = document.getElementById('aiResponseBox');
            const loader = document.getElementById('aiLoading');
            const content = document.getElementById('aiContent');

            box.classList.remove('hidden');
            loader.classList.remove('hidden');
            content.innerHTML = "";
            content.classList.add('hidden');

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
                });

                if (!response.ok) throw new Error("Error en la respuesta de API");

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No pude obtener respuesta. Verifica tu API Key.";
                const formattedText = aiText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                content.innerHTML = formattedText;
            } catch (error) {
                content.innerHTML = "<span class='text-red-400'>Error de conexi√≥n. Puede que tu API Key sea incorrecta o haya expirado. <br><u onclick='resetApiKey()' style='cursor:pointer'>Haz clic aqu√≠ para cambiar la Key</u>.</span>";
                console.error(error);
            } finally {
                loader.classList.add('hidden');
                content.classList.remove('hidden');
            }
        }

        // --- FUNCIONES IA ORIGINALES ---
        function verifyPlayer() {
            const player = document.getElementById('playerInput').value.trim();
            if (!player) return alert("Escribe un nombre.");
            clearInterval(timerInterval);
            const prompt = `Act√∫a como un experto en f√∫tbol. El usuario dice que el jugador "${player}" es de nacionalidad "${currentChallenge.country}", jug√≥ en el equipo "${currentChallenge.team}" y particip√≥ en la competici√≥n "${currentChallenge.comp}".
            1. Verifica la NACIONALIDAD del jugador (¬øEs de ${currentChallenge.country}?).
            2. Verifica si jug√≥ en ese EQUIPO.
            3. Verifica si jug√≥ esa COMPETICI√ìN con ese equipo.
            Responde SI o NO y una explicaci√≥n muy breve. Si la nacionalidad no coincide, dilo claramente.`;
            callGemini(prompt);
        }

        function getHint() {
            const prompt = `Dame una pista sobre un jugador de nacionalidad "${currentChallenge.country}" que haya jugado en "${currentChallenge.team}" y la competici√≥n "${currentChallenge.comp}". M√°ximo 2 frases. NO digas el nombre. Si no existe ninguno famoso, di "Es un reto muy dif√≠cil".`;
            callGemini(prompt);
        }

        function getSolution() {
            clearInterval(timerInterval);
            const prompt = `Lista hasta 3 jugadores de nacionalidad "${currentChallenge.country}" que hayan jugado en "${currentChallenge.team}" disputando la "${currentChallenge.comp}". Si no hay ninguno, di "No existen registros comunes".`;
            callGemini(prompt);
        }

        // --- NUEVAS FUNCIONES IA (CREATIVAS) ---
        function narrateIntro() {
            const prompt = `Act√∫a como un narrador de f√∫tbol apasionado (estilo latinoamericano o europeo).
            Escribe una INTRODUCCI√ìN √âPICA y muy breve (m√°ximo 40 palabras) para un partido crucial donde juega el **${currentChallenge.team}** en la **${currentChallenge.comp}**.
            Debes mencionar que hay un jugador clave de nacionalidad **${currentChallenge.country}** en el campo que se roba las miradas.
            Usa exclamaciones y emojis de f√∫tbol.`;
            callGemini(prompt);
        }

        function suggestTactics() {
            const prompt = `Act√∫a como un Director T√©cnico experto (tipo Guardiola o Klopp).
            Para ganar la **${currentChallenge.comp}** con el equipo **${currentChallenge.team}**, sugiere:
            1. La formaci√≥n t√°ctica ideal (ej: 4-3-3, 3-5-2).
            2. Una frase clave sobre el estilo de juego necesario.
            Mant√©n la respuesta corta y directa.`;
            callGemini(prompt);
        }

        function startTimer() {
            const btn = document.getElementById('timerBtn');
            const display = document.getElementById('timerDisplay');
            let timeLeft = 15;
            btn.disabled = true; btn.classList.add('bg-red-600');
            clearInterval(timerInterval);
            display.textContent = `${timeLeft}s`;
            timerInterval = setInterval(() => {
                timeLeft--;
                display.textContent = `${timeLeft}s`;
                if (timeLeft <= 0) { clearInterval(timerInterval); display.textContent = "¬°TIEMPO!"; }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            const btn = document.getElementById('timerBtn');
            const display = document.getElementById('timerDisplay');
            btn.disabled = false; btn.classList.remove('bg-red-600');
            display.textContent = "15s";
        }

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes bounceIn { 0% { transform: translateY(-50px); opacity: 0; } 60% { transform: translateY(10px); opacity: 1; } 100% { transform: translateY(0); } }`;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>
